---
- name: instalar o sonar-scanner no Jenkins Server Master
  hosts: jenkins

  user: vagrant
  become: yes
  
  tasks:
    - name: instalacao do unzip
      yum:
        name: unzip
        state: latest
    - name: Donwload do sonar-scanner 
      get_url:
        url: https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.6.2.2472-linux.zip
        dest: /opt/sonar-scanner-cli-4.6.2.2472-linux.zip
    - name: Unzip do pacote sonar-scanner
      ansible.builtin.unarchive:
        src: /opt/sonar-scanner-cli-4.6.2.2472-linux.zip
        dest: /opt/
        remote_src: yes
    - name: stat sonar-scanner
      ansible.builtin.stat: 
          path=/opt/sonar-scanner
      register: sonarstat
    - name: Alterar o nome da pasta sonar
      command: 
        mv /opt/sonar-scanner-cli-4.6.2.2472-linux /opt/sonar-scanner
      when: sonarstat.stat.isdir is not defined
    - name: Change permission da pasta sonar-scanner
      file:
        path: /opt/sonar-scanner
        state: directory
        owner: jenkins
        group: jenkins
        mode: a+x
      when: sonarstat.stat.isdir is not defined
    - name: Alterar o profile 
      lineinfile:
        dest: /etc/profile
        state: present
        line: "{{item}}"
      with_items:
        - export PATH=$PATH:/opt/sonar-scanner/bi
      when: sonarstat.stat.isdir is not defined
  roles:
    - configuracao-dafault-so



    
